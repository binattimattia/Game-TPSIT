<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MBM | Maths</title>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      text-align: center;
      padding-top: 50px;
    }
    .question {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 30px;
    }
    .answer-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }
    .score-container {
      margin-top: 20px;
    }
    .timer {
      font-size: 24px;
      font-weight: bold;
      color: #e74c3c;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1 class="mb-4">🧮 Risolvi il Calcolo!</h1>
    <div id="question" class="question text-primary"></div>
    <div id="buttons" class="answer-buttons"></div>
    
    <!-- Punteggio -->
    <div class="score-container">
      <h4>Punteggio: <span id="current-score">0</span></h4>
    </div>

    <!-- Timer -->
    <div class="timer" id="timer">Tempo rimasto: 10s</div>

    <div id="result" class="mt-4 fs-4 fw-bold"></div>
  </div>

  <script>
    let correctAnswer;
    let currentScore = 0;
    let timerValue = 10;
    let timerInterval;

    // Genera una nuova operazione matematica
    function generaCalcolo() {
      const num1 = Math.floor(Math.random() * 20);
      const num2 = Math.floor(Math.random() * 20);
      const operazione = ["+", "-", "*"][Math.floor(Math.random() * 3)];

      const domanda = `${num1} ${operazione} ${num2}`;
      correctAnswer = eval(domanda);

      document.getElementById("question").textContent = domanda;
      generaBottoniRisposta(correctAnswer);
      resetTimer();
    }

    // Genera 4 bottoni, uno corretto e tre sbagliati
    function generaBottoniRisposta(corretta) {
      const container = document.getElementById("buttons");
      container.innerHTML = "";

      const posizioneCorretta = Math.floor(Math.random() * 4);
      const risposte = [];

      for (let i = 0; i < 4; i++) {
        if (i === posizioneCorretta) {
          risposte.push(corretta);
        } else {
          let offset = Math.floor(Math.random() * 10) + 1;
          let sbagliata;

          if (Math.random() > 0.5) {
            sbagliata = corretta + offset;
          } else {
            sbagliata = corretta - offset;
          }

          risposte.push(sbagliata);
        }
      }

      for (let i = 0; i < risposte.length; i++) {
        const btn = document.createElement("button");
        btn.className = "btn btn-outline-primary btn-lg";
        btn.textContent = risposte[i];
        btn.onclick = function() {
          controllaRisposta(risposte[i]);
        };
        container.appendChild(btn);
      }
    }

    // Controlla se la risposta è giusta
    function controllaRisposta(scelta) {
      const risultato = document.getElementById("result");

      if (scelta === correctAnswer) {
        currentScore++;
        risultato.textContent = "✅ Corretto!";
        risultato.classList.remove("text-danger");
        risultato.classList.add("text-success");
      } else {
        currentScore = 0;
        risultato.textContent = "❌ Sbagliato!";
        risultato.classList.remove("text-success");
        risultato.classList.add("text-danger");
      }

      document.getElementById("current-score").textContent = currentScore;

      setTimeout(function() {
        risultato.textContent = "";
        generaCalcolo();
      }, 1500);
    }

    // Timer che conta alla rovescia
    function resetTimer() {
      clearInterval(timerInterval);
      timerValue = 10;
      document.getElementById("timer").textContent = `Tempo Rimasto: ${timerValue}s`;

      timerInterval = setInterval(function() {
        timerValue--;
        document.getElementById("timer").textContent = `Tempo Rimasto: ${timerValue}s`;

        if (timerValue <= 0) {
          clearInterval(timerInterval);
          document.getElementById("result").textContent = "❌ Tempo Scaduto!";
          document.getElementById("result").classList.add("text-danger");

          currentScore = 0;
          document.getElementById("current-score").textContent = currentScore;

          setTimeout(function() {
            document.getElementById("result").textContent = "";
            generaCalcolo();
          }, 1500);
        }
      }, 1000);
    }

    // Avvia il gioco alla partenza
    generaCalcolo();
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script> 
  <script src="js/bootstrap.min.js" ></script>
</body>
</html>
